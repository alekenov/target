# Инструменты для пошагового анализа рекламных кампаний Facebook

Данный набор инструментов позволяет проводить детальный пошаговый анализ рекламных кампаний в Facebook, с учетом ограничений API и использованием кэширования.

## Компоненты

1. **campaign_analyzer.py** - полный класс для пошагового анализа рекламных кампаний с детализацией до уровня объявлений
2. **analyze_campaign_step_by_step.py** - простой скрипт для быстрого последовательного анализа рекламных кампаний
3. **campaign_analysis.sh** - скрипт командной строки для удобного запуска анализа
4. **cache_handler.py** - утилита для кэширования данных API (находится в ../utils/)

## Пошаговый анализ

Основная идея пошагового анализа заключается в:
- Анализе рекламных кампаний по одной за раз
- Сохранении результатов каждого анализа в отдельный файл
- Соблюдении пауз между запросами для избежания ограничений API
- Использовании кэширования для минимизации количества запросов

## Возможности

- Получение и фильтрация списка активных кампаний
- Анализ показателей эффективности (CTR, CPC, охват и др.)
- Анализ настроек таргетинга кампаний
- Общая оценка эффективности с рекомендациями
- Сохранение детального отчета в JSON-формате

## Использование скрипта analyze_campaign_step_by_step.py

### Анализ всех кампаний за 2025 год

```bash
python analyze_campaign_step_by_step.py --year 2025 --use-cache
```

### Анализ конкретной кампании

```bash
python analyze_campaign_step_by_step.py --campaign-id YOUR_CAMPAIGN_ID --days 14
```

### Параметры командной строки

- `--campaign-id` - ID конкретной кампании для анализа
- `--year` - Год для фильтрации кампаний (по умолчанию 2025)
- `--days` - Количество дней для анализа (по умолчанию 14)
- `--output-dir` - Директория для сохранения отчетов (по умолчанию 'reports')
- `--use-cache` - Использовать кэширование
- `--clear-cache` - Очистить кэш перед запуском
- `--wait-time` - Время ожидания между анализами кампаний в секундах (по умолчанию 60)
- `--debug` - Включить расширенное логирование
- `--access-token` - Токен доступа к API Facebook
- `--account-id` - ID рекламного аккаунта

## Обход ограничений API

В скрипты внедрены следующие механизмы для обхода ограничений API:

1. **Кэширование результатов** - все запросы к API кэшируются для повторного использования
2. **Паузы между запросами** - добавлены паузы 5 секунд между запросами для соблюдения ограничений API
3. **Обработка ошибок** - при превышении лимитов API скрипт делает паузу 5 минут и затем продолжает работу
4. **Пошаговый анализ** - анализ по одной кампании за раз с паузой между ними

## Пример вывода анализа кампании

```
================================================================================
АНАЛИЗ КАМПАНИИ: Цветы к 8 марта (ID: 120205044838316)
================================================================================

ОСНОВНАЯ ИНФОРМАЦИЯ:
Цель: OUTCOME_TRAFFIC
Статус: ACTIVE
Дата создания: 2025-02-15T10:30:00+0000

ЭФФЕКТИВНОСТЬ:
Расход: 5000.45
Показы: 125000
Клики: 2500
CTR: 2.00%
CPC: 2.00

ГРУППЫ ОБЪЯВЛЕНИЙ (3):
1. Москва и область - ACTIVE
2. Санкт-Петербург - ACTIVE
3. Другие регионы - ACTIVE

ОБЩАЯ ОЦЕНКА:
Эффективность: Высокая

Сильные стороны:
- Высокий CTR
- Низкая стоимость клика

РЕКОМЕНДАЦИИ:
1. Для цели привлечения трафика оптимизируйте по показателю CPC
================================================================================
```

## Работа с кэшем

Для управления кэшем используйте следующие опции:

- `--use-cache` - включить использование кэша
- `--clear-cache` - очистить кэш перед запуском
- `--no-cache` для отключения кэша в скрипте campaign_analyzer.py

Кэш хранится в директории `cache/` и содержит файлы с результатами запросов к API.

## Рекомендации по использованию

1. Начинайте с анализа одной кампании с использованием кэша для проверки работоспособности
2. Используйте режим отладки `--debug` для получения подробной информации
3. Увеличивайте время ожидания между кампаниями `--wait-time` при возникновении ограничений API
4. Для ежедневного анализа используйте `--days 7` или `--days 14` для получения актуальных данных 